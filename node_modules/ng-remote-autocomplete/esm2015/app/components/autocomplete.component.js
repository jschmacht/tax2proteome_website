/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ContentChild, TemplateRef, forwardRef, ViewChild, ElementRef } from "@angular/core";
import { NG_VALUE_ACCESSOR } from "@angular/forms";
import { DEFAULT_MAX_CHARS, DEFAULT_MIN_SEARCH_LENGTH, DEFAULT_PAUSE, NOT_FOUND_TEXT, SEARCHING_TEXT, DEFAULT_ACTIVE_INDEX, SEARCH_WRAPPER_CLASS, OPTION_LIST_WRAPPER_CLASS, OPTION_CLASS, OPTION_VALUE_CLASS, OPTION_DESCRIPTION_CLASS, LOADING_CLASS, RESULTS_NOT_FOUND_CLASS } from "../constants/autocomplete.constants";
import { SearchStateType } from "../enums/search-state.type";
import { OptionTemplateDirective } from "../directives/option-template.directive";
import { ItemListService } from "../services/item-list.service";
import { AutocompleteService } from "../services/autocomplete.service";
export class RemoteAutocompleteComponent {
    /**
     * @param {?} itemListService
     * @param {?} autocompleteService
     */
    constructor(itemListService, autocompleteService) {
        this.itemListService = itemListService;
        this.autocompleteService = autocompleteService;
        this.stopEnterPropagationOnSelect = false;
        this.needToShowNotFoundText = true;
        this.needToShowSearchingText = true;
        this.type = new EventEmitter();
        this.highlighted = new EventEmitter();
        this.selected = new EventEmitter();
        this.blur = new EventEmitter();
        this.focusEvent = new EventEmitter();
        this.searchStates = SearchStateType;
        this.searchState = SearchStateType.Untracked;
        this.SEARCH_WRAPPER_CLASS = SEARCH_WRAPPER_CLASS;
        this.OPTION_LIST_WRAPPER_CLASS = OPTION_LIST_WRAPPER_CLASS;
        this.OPTION_CLASS = OPTION_CLASS;
        this.OPTION_VALUE_CLASS = OPTION_VALUE_CLASS;
        this.OPTION_DESCRIPTION_CLASS = OPTION_DESCRIPTION_CLASS;
        this.LOADING_CLASS = LOADING_CLASS;
        this.RESULTS_NOT_FOUND_CLASS = RESULTS_NOT_FOUND_CLASS;
        this.propagateChange = (/**
         * @param {?} _
         * @return {?}
         */
        (_) => { });
        this.propagateTouched = (/**
         * @param {?} _
         * @return {?}
         */
        (_) => { });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.validateService();
        this.disabled = this.getDefaultIfNullOrUndefined(this.disabled, false);
        this.minChars = this.getDefaultIfNullOrUndefined(this.minChars, DEFAULT_MIN_SEARCH_LENGTH);
        this.maxChars = this.maxChars || DEFAULT_MAX_CHARS;
        this.pause = this.pause || DEFAULT_PAUSE;
        this.notFoundText = this.notFoundText || NOT_FOUND_TEXT;
        this.searchingText = this.searchingText || SEARCHING_TEXT;
        this.changedHighlightSubscription = this.autocompleteService.changedHighlightItemSubject.subscribe((/**
         * @param {?} index
         * @return {?}
         */
        (index) => {
            this.onActiveIndexChanged(index);
        }));
        this.selectSubscription = this.autocompleteService.selectItemSubject.subscribe((/**
         * @param {?} index
         * @return {?}
         */
        (index) => {
            /** @type {?} */
            const result = this.searchResult[index];
            this.propagateChange(result.value);
            this.selected.emit(result);
            this.close();
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.changedHighlightSubscription.unsubscribe();
        this.selectSubscription.unsubscribe();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        if (value !== undefined) {
            this.searchValue = value;
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.propagateChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.propagateTouched = fn;
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * @return {?}
     */
    onType() {
        this.propagateChange(this.searchValue);
        this.originalSearchValue = this.searchValue;
        this.type.emit();
        if (this.validsearchTerm()) {
            this.searchState = this.searchStates.Loading;
        }
        else {
            this.close();
        }
        this.resetSearchTimeout();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onInputBlur(event) {
        if (event.relatedTarget) {
            /** @type {?} */
            let related = (/** @type {?} */ (event.relatedTarget));
            if (related.classList.contains(this.OPTION_CLASS)) {
                return;
            }
        }
        this.propagateTouched(this.searchValue);
        this.close();
        this.blur.emit(event);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onInputFocus(event) {
        this.focusEvent.emit(event);
    }
    /**
     * @return {?}
     */
    get inputClass() {
        /** @type {?} */
        let classes = '';
        if (this.inputClasses) {
            classes = this.inputClasses.join(' ');
        }
        return classes;
    }
    /**
     * @return {?}
     */
    focus() {
        ((/** @type {?} */ (this.inputField.nativeElement))).focus();
    }
    /**
     * @return {?}
     */
    open() {
        this.onType();
    }
    /**
     * @return {?}
     */
    close() {
        this.autocompleteService.isOpen = false;
        this.searchState = this.searchStates.Untracked;
    }
    /**
     * @private
     * @return {?}
     */
    validateService() {
        if (!this.service) {
            throw new Error("AutocompleteService must be implemented");
        }
        if (this.isParameterizedSearch(this.service) && (this.searchParameters === undefined || this.searchParameters === null)) {
            throw new Error("Please provide additionalSearchParams or just provide AutocompleteSourceService instaead of ParameterizedAutocompleteSourceService");
        }
    }
    /**
     * @private
     * @param {?} activeIndex
     * @return {?}
     */
    onActiveIndexChanged(activeIndex) {
        /** @type {?} */
        let highlightedItem;
        if (activeIndex === DEFAULT_ACTIVE_INDEX) {
            highlightedItem = null;
            this.searchValue = this.originalSearchValue;
        }
        else {
            highlightedItem = this.searchResult[activeIndex];
            this.searchValue = highlightedItem.value;
        }
        this.propagateChange(this.searchValue);
        this.highlighted.emit(highlightedItem);
    }
    /**
     * @private
     * @return {?}
     */
    resetSearchTimeout() {
        this.clearSearchTimeout();
        this.setSearchTimeout();
    }
    /**
     * @private
     * @return {?}
     */
    setSearchTimeout() {
        this.typingTimeout = setTimeout(this.search.bind(this), this.pause);
    }
    /**
     * @private
     * @return {?}
     */
    clearSearchTimeout() {
        clearTimeout(this.typingTimeout);
    }
    /**
     * @private
     * @return {?}
     */
    search() {
        this.itemListService.restoreIntialActiveIndex();
        if (this.validsearchTerm()) {
            this.performSearch().first().subscribe((/**
             * @param {?} results
             * @return {?}
             */
            (results) => {
                if (this.searchState !== this.searchStates.Untracked) {
                    this.autocompleteService.isOpen = results.length > 0;
                    this.itemListService.items = results;
                    this.searchResult = results;
                    this.searchState = this.searchStates.Finished;
                }
            }));
        }
    }
    /**
     * @private
     * @return {?}
     */
    performSearch() {
        if (this.isParameterizedSearch(this.service)) {
            return ((/** @type {?} */ (this.service))).getWithParams(this.searchValue, this.searchParameters);
        }
        else {
            return ((/** @type {?} */ (this.service))).get(this.searchValue);
        }
    }
    /**
     * @private
     * @return {?}
     */
    validsearchTerm() {
        return (this.searchValue || '').length >= this.minChars;
    }
    /**
     * @private
     * @param {?} service
     * @return {?}
     */
    isParameterizedSearch(service) {
        return ((/** @type {?} */ (service))).getWithParams !== undefined;
    }
    /**
     * @private
     * @template T
     * @param {?} value
     * @param {?} defaultValue
     * @return {?}
     */
    getDefaultIfNullOrUndefined(value, defaultValue) {
        return value === undefined || value === null
            ? defaultValue
            : value;
    }
}
RemoteAutocompleteComponent.decorators = [
    { type: Component, args: [{
                selector: 'remote-autocomplete',
                template: `<div keyboard-navigation [stopEnterPropagation]="stopEnterPropagationOnSelect" class="remote-autocomplete">
    <input [(ngModel)]="searchValue"
           [attr.id]="inputId"
           [attr.name]="inputName"
           [attr.class]="inputClass"
           [disabled]="disabled"
           [attr.placeholder]="placeholder"
           [attr.autocomplete]="autocompleteAttr"
           [attr.tabindex]="tabindex"
           maxlength="{{maxChars}}"
           (input)="onType()"
           (blur)="onInputBlur($event)"
           (focus)="onInputFocus($event)"
           #input />
    <div *ngIf="searchState === searchStates.Loading && needToShowSearchingText || 
                searchState === searchStates.Finished && (searchResult?.length > 0 || needToShowNotFoundText)" [class]="SEARCH_WRAPPER_CLASS">
        <div *ngIf="searchState === searchStates.Loading">
            <span [class]="LOADING_CLASS">{{searchingText}}</span>
        </div>

        <div *ngIf="searchState === searchStates.Finished && searchResult.length === 0">
            <span [class]="RESULTS_NOT_FOUND_CLASS">{{notFoundText}}</span>
        </div>

        <div *ngIf="searchState === searchStates.Finished && searchResult?.length > 0" [class]="OPTION_LIST_WRAPPER_CLASS">
            <div *ngFor="let item of searchResult; index as i"
                 remote-autocomplete-option
                 [itemIndex]="i"
                 [class]="OPTION_CLASS"
                 [ngClass]="{'autocomplete-option-active': i === itemListService.activeIndex}"
                 tabindex="-1">
                <ng-template #defaultOptionTemplate>
                    <span [class]="OPTION_VALUE_CLASS">{{item.value}}</span>
                    <span *ngIf="item.description" [class]="OPTION_DESCRIPTION_CLASS">{{item.description}}</span>
                </ng-template>

                <ng-template [ngTemplateOutlet]="optionTemplate || defaultOptionTemplate" [ngTemplateOutletContext]="{ $implicit: item }">
                </ng-template>
            </div>
        </div>
    </div>
</div>`,
                styles: [`.autocomplete-search-wrapper{border:1px solid #ccc;max-height:200px;overflow:auto;max-width:200px}.autocomplete-option-active{background-color:#d3d3d3}`],
                providers: [
                    AutocompleteService,
                    ItemListService,
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => RemoteAutocompleteComponent)),
                        multi: true
                    }
                ]
            },] },
];
RemoteAutocompleteComponent.ctorParameters = () => [
    { type: ItemListService },
    { type: AutocompleteService }
];
RemoteAutocompleteComponent.propDecorators = {
    service: [{ type: Input, args: ['service',] }],
    minChars: [{ type: Input, args: ['minSearchLength',] }],
    maxChars: [{ type: Input, args: ['maxChars',] }],
    pause: [{ type: Input, args: ['pause',] }],
    inputId: [{ type: Input, args: ['inputId',] }],
    inputName: [{ type: Input, args: ['inputName',] }],
    inputClasses: [{ type: Input, args: ['inputClass',] }],
    disabled: [{ type: Input, args: ['disabled',] }],
    notFoundText: [{ type: Input, args: ['notFoundText',] }],
    searchingText: [{ type: Input, args: ['searchingText',] }],
    placeholder: [{ type: Input, args: ['placeholder',] }],
    searchParameters: [{ type: Input, args: ['searchParameters',] }],
    autocompleteAttr: [{ type: Input, args: ['autocompleteAttr',] }],
    tabindex: [{ type: Input, args: ['tabindex',] }],
    stopEnterPropagationOnSelect: [{ type: Input, args: ['stopEnterPropagationOnSelect',] }],
    needToShowNotFoundText: [{ type: Input, args: ['needToShowNotFoundText',] }],
    needToShowSearchingText: [{ type: Input, args: ['needToShowSearchingText',] }],
    type: [{ type: Output, args: ['type',] }],
    highlighted: [{ type: Output, args: ['highlighted',] }],
    selected: [{ type: Output, args: ['selected',] }],
    blur: [{ type: Output, args: ['blur',] }],
    focusEvent: [{ type: Output, args: ['focus',] }],
    optionTemplate: [{ type: ContentChild, args: [OptionTemplateDirective, { read: TemplateRef },] }],
    inputField: [{ type: ViewChild, args: ['input',] }]
};
if (false) {
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.service;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.minChars;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.maxChars;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.pause;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.inputId;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.inputName;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.inputClasses;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.disabled;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.notFoundText;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.searchingText;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.placeholder;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.searchParameters;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.autocompleteAttr;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.tabindex;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.stopEnterPropagationOnSelect;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.needToShowNotFoundText;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.needToShowSearchingText;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.type;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.highlighted;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.selected;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.blur;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.focusEvent;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.optionTemplate;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.inputField;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.searchStates;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.searchState;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.searchValue;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.searchResult;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.SEARCH_WRAPPER_CLASS;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.OPTION_LIST_WRAPPER_CLASS;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.OPTION_CLASS;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.OPTION_VALUE_CLASS;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.OPTION_DESCRIPTION_CLASS;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.LOADING_CLASS;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.RESULTS_NOT_FOUND_CLASS;
    /**
     * @type {?}
     * @private
     */
    RemoteAutocompleteComponent.prototype.typingTimeout;
    /**
     * @type {?}
     * @private
     */
    RemoteAutocompleteComponent.prototype.originalSearchValue;
    /**
     * @type {?}
     * @private
     */
    RemoteAutocompleteComponent.prototype.changedHighlightSubscription;
    /**
     * @type {?}
     * @private
     */
    RemoteAutocompleteComponent.prototype.selectSubscription;
    /**
     * @type {?}
     * @private
     */
    RemoteAutocompleteComponent.prototype.propagateChange;
    /**
     * @type {?}
     * @private
     */
    RemoteAutocompleteComponent.prototype.propagateTouched;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.itemListService;
    /** @type {?} */
    RemoteAutocompleteComponent.prototype.autocompleteService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXJlbW90ZS1hdXRvY29tcGxldGUvIiwic291cmNlcyI6WyJhcHAvY29tcG9uZW50cy9hdXRvY29tcGxldGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFDWixXQUFXLEVBRVgsVUFBVSxFQUNWLFNBQVMsRUFDVCxVQUFVLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBT3pFLE9BQU8sRUFDSCxpQkFBaUIsRUFDakIseUJBQXlCLEVBQ3pCLGFBQWEsRUFDYixjQUFjLEVBQ2QsY0FBYyxFQUNkLG9CQUFvQixFQUNwQixvQkFBb0IsRUFDcEIseUJBQXlCLEVBQ3pCLFlBQVksRUFDWixrQkFBa0IsRUFDbEIsd0JBQXdCLEVBQ3hCLGFBQWEsRUFDYix1QkFBdUIsRUFDMUIsTUFBTSxxQ0FBcUMsQ0FBQztBQUU3QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBNER2RSxNQUFNOzs7OztJQWlERixZQUFtQixlQUFnQyxFQUN4QyxtQkFBd0M7UUFEaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ3hDLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFuQ1osaUNBQTRCLEdBQVksS0FBSyxDQUFDO1FBQ3ZELDJCQUFzQixHQUFZLElBQUksQ0FBQztRQUN0Qyw0QkFBdUIsR0FBWSxJQUFJLENBQUM7UUFFdkQs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TUFBTTswQkFDYixNQUFNLFNBQUMsYUFBYTt1QkFDcEIsTUFBTSxTQUFDLFVBQVU7bUJBQ2pCLE1BQU0sU0FBQyxNQUFNO3lCQUNiLE1BQU0sU0FBQyxPQUFPOzZCQUdkLFlBQVksU0FBQyx1QkFBdUIsRUFBRSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUU7eUJBRTNELFNBQVMsU0FBQyxPQUFPOzs7O0lBM0JsQiw4Q0FBOEY7O0lBQzlGLCtDQUEyQzs7SUFDM0MsK0NBQW9DOztJQUNwQyw0Q0FBOEI7O0lBQzlCLDhDQUFrQzs7SUFDbEMsZ0RBQXNDOztJQUN0QyxtREFBNEM7O0lBQzVDLCtDQUFxQzs7SUFDckMsbURBQTRDOztJQUM1QyxvREFBOEM7O0lBQzlDLGtEQUEwQzs7SUFDMUMsdURBQWlEOztJQUNqRCx1REFBb0Q7O0lBQ3BELCtDQUFvQzs7SUFDcEMsbUVBQXFGOztJQUN4Riw2REFBd0U7O0lBQ3hFLDhEQUEwRTs7SUFFdkUsMkNBQW9FOztJQUNwRSxrREFBMEc7O0lBQzFHLCtDQUFvRzs7SUFDcEcsMkNBQXNFOztJQUN0RSxpREFBNkU7O0lBRzdFLHFEQUErRjs7SUFFL0YsaURBQTJDOztJQUUzQyxtREFBc0M7O0lBQ3RDLGtEQUErQzs7SUFDL0Msa0RBQTJCOztJQUMzQixtREFBd0M7O0lBQ3hDLDJEQUEyRDs7SUFDM0QsZ0VBQXFFOztJQUNyRSxtREFBMkM7O0lBQzNDLHlEQUF1RDs7SUFDdkQsK0RBQW1FOztJQUNuRSxvREFBNkM7O0lBQzdDLDhEQUFpRTs7Ozs7SUFFakUsb0RBQThCOzs7OztJQUM5QiwwREFBb0M7Ozs7O0lBQ3BDLG1FQUFtRDs7Ozs7SUFDbkQseURBQXlDOzs7OztJQUN6QyxzREFBMEM7Ozs7O0lBQzFDLHVEQUEyQzs7SUFFL0Isc0RBQXVDOztJQUMvQywwREFBK0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgT25Jbml0LFxyXG4gICAgSW5wdXQsXHJcbiAgICBPdXRwdXQsXHJcbiAgICBFdmVudEVtaXR0ZXIsXHJcbiAgICBDb250ZW50Q2hpbGQsXHJcbiAgICBUZW1wbGF0ZVJlZixcclxuICAgIE9uRGVzdHJveSxcclxuICAgIGZvcndhcmRSZWYsXHJcbiAgICBWaWV3Q2hpbGQsXHJcbiAgICBFbGVtZW50UmVmXHJcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuXHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5cclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcy9SeCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9PYnNlcnZhYmxlXCI7XHJcblxyXG5pbXBvcnQgeyBBdXRvY29tcGxldGVJdGVtIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvYXV0b2NvbXBsZXRlLml0ZW1cIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgICBERUZBVUxUX01BWF9DSEFSUyxcclxuICAgIERFRkFVTFRfTUlOX1NFQVJDSF9MRU5HVEgsXHJcbiAgICBERUZBVUxUX1BBVVNFLFxyXG4gICAgTk9UX0ZPVU5EX1RFWFQsXHJcbiAgICBTRUFSQ0hJTkdfVEVYVCxcclxuICAgIERFRkFVTFRfQUNUSVZFX0lOREVYLFxyXG4gICAgU0VBUkNIX1dSQVBQRVJfQ0xBU1MsXHJcbiAgICBPUFRJT05fTElTVF9XUkFQUEVSX0NMQVNTLFxyXG4gICAgT1BUSU9OX0NMQVNTLFxyXG4gICAgT1BUSU9OX1ZBTFVFX0NMQVNTLFxyXG4gICAgT1BUSU9OX0RFU0NSSVBUSU9OX0NMQVNTLFxyXG4gICAgTE9BRElOR19DTEFTUyxcclxuICAgIFJFU1VMVFNfTk9UX0ZPVU5EX0NMQVNTXHJcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy9hdXRvY29tcGxldGUuY29uc3RhbnRzXCI7XHJcblxyXG5pbXBvcnQgeyBTZWFyY2hTdGF0ZVR5cGUgfSBmcm9tIFwiLi4vZW51bXMvc2VhcmNoLXN0YXRlLnR5cGVcIjtcclxuaW1wb3J0IHsgT3B0aW9uVGVtcGxhdGVEaXJlY3RpdmUgfSBmcm9tIFwiLi4vZGlyZWN0aXZlcy9vcHRpb24tdGVtcGxhdGUuZGlyZWN0aXZlXCI7XHJcbmltcG9ydCB7IEl0ZW1MaXN0U2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9pdGVtLWxpc3Quc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBdXRvY29tcGxldGVTb3VyY2VTZXJ2aWNlIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvYXV0b2NvbXBsZXRlLXNvdXJjZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IEF1dG9jb21wbGV0ZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvYXV0b2NvbXBsZXRlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgUGFyYW1ldGVyaXplZEF1dG9jb21wbGV0ZVNvdXJjZVNlcnZpY2UgfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9wYXJhbWV0ZXJpemVkLWF1dG9jb21wbGV0ZS1zb3Vyc2Uuc2VydmlzZVwiO1xyXG5pbXBvcnQgeyBBdXRvY29tcGxldGUgfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9hdXRvY29tcGxldGVcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdyZW1vdGUtYXV0b2NvbXBsZXRlJyxcclxuICAgIHRlbXBsYXRlOiBgPGRpdiBrZXlib2FyZC1uYXZpZ2F0aW9uIFtzdG9wRW50ZXJQcm9wYWdhdGlvbl09XCJzdG9wRW50ZXJQcm9wYWdhdGlvbk9uU2VsZWN0XCIgY2xhc3M9XCJyZW1vdGUtYXV0b2NvbXBsZXRlXCI+XHJcbiAgICA8aW5wdXQgWyhuZ01vZGVsKV09XCJzZWFyY2hWYWx1ZVwiXHJcbiAgICAgICAgICAgW2F0dHIuaWRdPVwiaW5wdXRJZFwiXHJcbiAgICAgICAgICAgW2F0dHIubmFtZV09XCJpbnB1dE5hbWVcIlxyXG4gICAgICAgICAgIFthdHRyLmNsYXNzXT1cImlucHV0Q2xhc3NcIlxyXG4gICAgICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXHJcbiAgICAgICAgICAgW2F0dHIucGxhY2Vob2xkZXJdPVwicGxhY2Vob2xkZXJcIlxyXG4gICAgICAgICAgIFthdHRyLmF1dG9jb21wbGV0ZV09XCJhdXRvY29tcGxldGVBdHRyXCJcclxuICAgICAgICAgICBbYXR0ci50YWJpbmRleF09XCJ0YWJpbmRleFwiXHJcbiAgICAgICAgICAgbWF4bGVuZ3RoPVwie3ttYXhDaGFyc319XCJcclxuICAgICAgICAgICAoaW5wdXQpPVwib25UeXBlKClcIlxyXG4gICAgICAgICAgIChibHVyKT1cIm9uSW5wdXRCbHVyKCRldmVudClcIlxyXG4gICAgICAgICAgIChmb2N1cyk9XCJvbklucHV0Rm9jdXMoJGV2ZW50KVwiXHJcbiAgICAgICAgICAgI2lucHV0IC8+XHJcbiAgICA8ZGl2ICpuZ0lmPVwic2VhcmNoU3RhdGUgPT09IHNlYXJjaFN0YXRlcy5Mb2FkaW5nICYmIG5lZWRUb1Nob3dTZWFyY2hpbmdUZXh0IHx8IFxyXG4gICAgICAgICAgICAgICAgc2VhcmNoU3RhdGUgPT09IHNlYXJjaFN0YXRlcy5GaW5pc2hlZCAmJiAoc2VhcmNoUmVzdWx0Py5sZW5ndGggPiAwIHx8IG5lZWRUb1Nob3dOb3RGb3VuZFRleHQpXCIgW2NsYXNzXT1cIlNFQVJDSF9XUkFQUEVSX0NMQVNTXCI+XHJcbiAgICAgICAgPGRpdiAqbmdJZj1cInNlYXJjaFN0YXRlID09PSBzZWFyY2hTdGF0ZXMuTG9hZGluZ1wiPlxyXG4gICAgICAgICAgICA8c3BhbiBbY2xhc3NdPVwiTE9BRElOR19DTEFTU1wiPnt7c2VhcmNoaW5nVGV4dH19PC9zcGFuPlxyXG4gICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICA8ZGl2ICpuZ0lmPVwic2VhcmNoU3RhdGUgPT09IHNlYXJjaFN0YXRlcy5GaW5pc2hlZCAmJiBzZWFyY2hSZXN1bHQubGVuZ3RoID09PSAwXCI+XHJcbiAgICAgICAgICAgIDxzcGFuIFtjbGFzc109XCJSRVNVTFRTX05PVF9GT1VORF9DTEFTU1wiPnt7bm90Rm91bmRUZXh0fX08L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgIDxkaXYgKm5nSWY9XCJzZWFyY2hTdGF0ZSA9PT0gc2VhcmNoU3RhdGVzLkZpbmlzaGVkICYmIHNlYXJjaFJlc3VsdD8ubGVuZ3RoID4gMFwiIFtjbGFzc109XCJPUFRJT05fTElTVF9XUkFQUEVSX0NMQVNTXCI+XHJcbiAgICAgICAgICAgIDxkaXYgKm5nRm9yPVwibGV0IGl0ZW0gb2Ygc2VhcmNoUmVzdWx0OyBpbmRleCBhcyBpXCJcclxuICAgICAgICAgICAgICAgICByZW1vdGUtYXV0b2NvbXBsZXRlLW9wdGlvblxyXG4gICAgICAgICAgICAgICAgIFtpdGVtSW5kZXhdPVwiaVwiXHJcbiAgICAgICAgICAgICAgICAgW2NsYXNzXT1cIk9QVElPTl9DTEFTU1wiXHJcbiAgICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwieydhdXRvY29tcGxldGUtb3B0aW9uLWFjdGl2ZSc6IGkgPT09IGl0ZW1MaXN0U2VydmljZS5hY3RpdmVJbmRleH1cIlxyXG4gICAgICAgICAgICAgICAgIHRhYmluZGV4PVwiLTFcIj5cclxuICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSAjZGVmYXVsdE9wdGlvblRlbXBsYXRlPlxyXG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIFtjbGFzc109XCJPUFRJT05fVkFMVUVfQ0xBU1NcIj57e2l0ZW0udmFsdWV9fTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cIml0ZW0uZGVzY3JpcHRpb25cIiBbY2xhc3NdPVwiT1BUSU9OX0RFU0NSSVBUSU9OX0NMQVNTXCI+e3tpdGVtLmRlc2NyaXB0aW9ufX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG5cclxuICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdUZW1wbGF0ZU91dGxldF09XCJvcHRpb25UZW1wbGF0ZSB8fCBkZWZhdWx0T3B0aW9uVGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyAkaW1wbGljaXQ6IGl0ZW0gfVwiPlxyXG4gICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuPC9kaXY+YCxcclxuICAgIHN0eWxlczogW2AuYXV0b2NvbXBsZXRlLXNlYXJjaC13cmFwcGVye2JvcmRlcjoxcHggc29saWQgI2NjYzttYXgtaGVpZ2h0OjIwMHB4O292ZXJmbG93OmF1dG87bWF4LXdpZHRoOjIwMHB4fS5hdXRvY29tcGxldGUtb3B0aW9uLWFjdGl2ZXtiYWNrZ3JvdW5kLWNvbG9yOiNkM2QzZDN9YF0sXHJcbiAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICBBdXRvY29tcGxldGVTZXJ2aWNlLFxyXG4gICAgICAgIEl0ZW1MaXN0U2VydmljZSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBSZW1vdGVBdXRvY29tcGxldGVDb21wb25lbnQpLFxyXG4gICAgICAgICAgICBtdWx0aTogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIF1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBSZW1vdGVBdXRvY29tcGxldGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEF1dG9jb21wbGV0ZSB7XHJcbiAgICBASW5wdXQoJ3NlcnZpY2UnKSBzZXJ2aWNlOiBBdXRvY29tcGxldGVTb3VyY2VTZXJ2aWNlIHwgUGFyYW1ldGVyaXplZEF1dG9jb21wbGV0ZVNvdXJjZVNlcnZpY2U7XHJcbiAgICBASW5wdXQoJ21pblNlYXJjaExlbmd0aCcpIG1pbkNoYXJzOiBudW1iZXI7XHJcbiAgICBASW5wdXQoJ21heENoYXJzJykgbWF4Q2hhcnM6IG51bWJlcjtcclxuICAgIEBJbnB1dCgncGF1c2UnKSBwYXVzZTogbnVtYmVyO1xyXG4gICAgQElucHV0KCdpbnB1dElkJykgaW5wdXRJZDogc3RyaW5nO1xyXG4gICAgQElucHV0KCdpbnB1dE5hbWUnKSBpbnB1dE5hbWU6IHN0cmluZztcclxuICAgIEBJbnB1dCgnaW5wdXRDbGFzcycpIGlucHV0Q2xhc3Nlczogc3RyaW5nW107XHJcbiAgICBASW5wdXQoJ2Rpc2FibGVkJykgZGlzYWJsZWQ6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoJ25vdEZvdW5kVGV4dCcpIG5vdEZvdW5kVGV4dDogc3RyaW5nO1xyXG4gICAgQElucHV0KCdzZWFyY2hpbmdUZXh0Jykgc2VhcmNoaW5nVGV4dDogc3RyaW5nO1xyXG4gICAgQElucHV0KCdwbGFjZWhvbGRlcicpIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoJ3NlYXJjaFBhcmFtZXRlcnMnKSBzZWFyY2hQYXJhbWV0ZXJzOiBhbnk7XHJcbiAgICBASW5wdXQoJ2F1dG9jb21wbGV0ZUF0dHInKSBhdXRvY29tcGxldGVBdHRyOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoJ3RhYmluZGV4JykgdGFiaW5kZXg6IG51bWJlcjtcclxuICAgIEBJbnB1dCgnc3RvcEVudGVyUHJvcGFnYXRpb25PblNlbGVjdCcpIHN0b3BFbnRlclByb3BhZ2F0aW9uT25TZWxlY3Q6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHRASW5wdXQoJ25lZWRUb1Nob3dOb3RGb3VuZFRleHQnKSBuZWVkVG9TaG93Tm90Rm91bmRUZXh0OiBib29sZWFuID0gdHJ1ZTtcclxuXHRASW5wdXQoJ25lZWRUb1Nob3dTZWFyY2hpbmdUZXh0JykgbmVlZFRvU2hvd1NlYXJjaGluZ1RleHQ6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIEBPdXRwdXQoJ3R5cGUnKSB0eXBlOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcbiAgICBAT3V0cHV0KCdoaWdobGlnaHRlZCcpIGhpZ2hsaWdodGVkOiBFdmVudEVtaXR0ZXI8QXV0b2NvbXBsZXRlSXRlbT4gPSBuZXcgRXZlbnRFbWl0dGVyPEF1dG9jb21wbGV0ZUl0ZW0+KCk7XHJcbiAgICBAT3V0cHV0KCdzZWxlY3RlZCcpIHNlbGVjdGVkOiBFdmVudEVtaXR0ZXI8QXV0b2NvbXBsZXRlSXRlbT4gPSBuZXcgRXZlbnRFbWl0dGVyPEF1dG9jb21wbGV0ZUl0ZW0+KCk7XHJcbiAgICBAT3V0cHV0KCdibHVyJykgYmx1cjogRXZlbnRFbWl0dGVyPEV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8RXZlbnQ+KCk7XHJcbiAgICBAT3V0cHV0KCdmb2N1cycpIGZvY3VzRXZlbnQ6IEV2ZW50RW1pdHRlcjxFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEV2ZW50PigpO1xyXG5cclxuICAgIC8vY3VzdG9tIHRlbXBsYXRlXHJcbiAgICBAQ29udGVudENoaWxkKE9wdGlvblRlbXBsYXRlRGlyZWN0aXZlLCB7IHJlYWQ6IFRlbXBsYXRlUmVmIH0pIG9wdGlvblRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2lucHV0JykgaW5wdXRGaWVsZDogRWxlbWVudFJlZjtcclxuXHJcbiAgICBwdWJsaWMgc2VhcmNoU3RhdGVzID0gU2VhcmNoU3RhdGVUeXBlO1xyXG4gICAgcHVibGljIHNlYXJjaFN0YXRlID0gU2VhcmNoU3RhdGVUeXBlLlVudHJhY2tlZDtcclxuICAgIHB1YmxpYyBzZWFyY2hWYWx1ZTogc3RyaW5nO1xyXG4gICAgcHVibGljIHNlYXJjaFJlc3VsdDogQXV0b2NvbXBsZXRlSXRlbVtdO1xyXG4gICAgcHVibGljIFNFQVJDSF9XUkFQUEVSX0NMQVNTOiBzdHJpbmcgPSBTRUFSQ0hfV1JBUFBFUl9DTEFTUztcclxuICAgIHB1YmxpYyBPUFRJT05fTElTVF9XUkFQUEVSX0NMQVNTOiBzdHJpbmcgPSBPUFRJT05fTElTVF9XUkFQUEVSX0NMQVNTO1xyXG4gICAgcHVibGljIE9QVElPTl9DTEFTUzogc3RyaW5nID0gT1BUSU9OX0NMQVNTO1xyXG4gICAgcHVibGljIE9QVElPTl9WQUxVRV9DTEFTUzogc3RyaW5nID0gT1BUSU9OX1ZBTFVFX0NMQVNTO1xyXG4gICAgcHVibGljIE9QVElPTl9ERVNDUklQVElPTl9DTEFTUzogc3RyaW5nID0gT1BUSU9OX0RFU0NSSVBUSU9OX0NMQVNTO1xyXG4gICAgcHVibGljIExPQURJTkdfQ0xBU1M6IHN0cmluZyA9IExPQURJTkdfQ0xBU1M7XHJcbiAgICBwdWJsaWMgUkVTVUxUU19OT1RfRk9VTkRfQ0xBU1M6IHN0cmluZyA9IFJFU1VMVFNfTk9UX0ZPVU5EX0NMQVNTO1xyXG5cclxuICAgIHByaXZhdGUgdHlwaW5nVGltZW91dDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBvcmlnaW5hbFNlYXJjaFZhbHVlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGNoYW5nZWRIaWdobGlnaHRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgc2VsZWN0U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIHByb3BhZ2F0ZUNoYW5nZSA9IChfOiBhbnkpID0+IHsgfTtcclxuICAgIHByaXZhdGUgcHJvcGFnYXRlVG91Y2hlZCA9IChfOiBhbnkpID0+IHsgfTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaXRlbUxpc3RTZXJ2aWNlOiBJdGVtTGlzdFNlcnZpY2UsXHJcbiAgICAgICAgcHVibGljIGF1dG9jb21wbGV0ZVNlcnZpY2U6IEF1dG9jb21wbGV0ZVNlcnZpY2UpIHtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnZhbGlkYXRlU2VydmljZSgpO1xyXG5cclxuICAgICAgICB0aGlzLmRpc2FibGVkID0gdGhpcy5nZXREZWZhdWx0SWZOdWxsT3JVbmRlZmluZWQodGhpcy5kaXNhYmxlZCwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMubWluQ2hhcnMgPSB0aGlzLmdldERlZmF1bHRJZk51bGxPclVuZGVmaW5lZCh0aGlzLm1pbkNoYXJzLCBERUZBVUxUX01JTl9TRUFSQ0hfTEVOR1RIKTtcclxuICAgICAgICB0aGlzLm1heENoYXJzID0gdGhpcy5tYXhDaGFycyB8fCBERUZBVUxUX01BWF9DSEFSUztcclxuICAgICAgICB0aGlzLnBhdXNlID0gdGhpcy5wYXVzZSB8fCBERUZBVUxUX1BBVVNFO1xyXG4gICAgICAgIHRoaXMubm90Rm91bmRUZXh0ID0gdGhpcy5ub3RGb3VuZFRleHQgfHwgTk9UX0ZPVU5EX1RFWFQ7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hpbmdUZXh0ID0gdGhpcy5zZWFyY2hpbmdUZXh0IHx8IFNFQVJDSElOR19URVhUO1xyXG5cclxuICAgICAgICB0aGlzLmNoYW5nZWRIaWdobGlnaHRTdWJzY3JpcHRpb24gPSB0aGlzLmF1dG9jb21wbGV0ZVNlcnZpY2UuY2hhbmdlZEhpZ2hsaWdodEl0ZW1TdWJqZWN0LnN1YnNjcmliZSgoaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9uQWN0aXZlSW5kZXhDaGFuZ2VkKGluZGV4KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RTdWJzY3JpcHRpb24gPSB0aGlzLmF1dG9jb21wbGV0ZVNlcnZpY2Uuc2VsZWN0SXRlbVN1YmplY3Quc3Vic2NyaWJlKChpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuc2VhcmNoUmVzdWx0W2luZGV4XTtcclxuICAgICAgICAgICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UocmVzdWx0LnZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNoYW5nZWRIaWdobGlnaHRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB0aGlzLnNlbGVjdFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KSB7XHJcbiAgICAgICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UgPSBmbjtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KSB7XHJcbiAgICAgICAgdGhpcy5wcm9wYWdhdGVUb3VjaGVkID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgb25UeXBlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlKHRoaXMuc2VhcmNoVmFsdWUpO1xyXG4gICAgICAgIHRoaXMub3JpZ2luYWxTZWFyY2hWYWx1ZSA9IHRoaXMuc2VhcmNoVmFsdWU7XHJcbiAgICAgICAgdGhpcy50eXBlLmVtaXQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMudmFsaWRzZWFyY2hUZXJtKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hTdGF0ZSA9IHRoaXMuc2VhcmNoU3RhdGVzLkxvYWRpbmc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yZXNldFNlYXJjaFRpbWVvdXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbklucHV0Qmx1cihldmVudDogRm9jdXNFdmVudCkge1xyXG4gICAgICAgIGlmIChldmVudC5yZWxhdGVkVGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIGxldCByZWxhdGVkID0gPEhUTUxFbGVtZW50PmV2ZW50LnJlbGF0ZWRUYXJnZXQ7XHJcbiAgICAgICAgICAgIGlmIChyZWxhdGVkLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLk9QVElPTl9DTEFTUykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5wcm9wYWdhdGVUb3VjaGVkKHRoaXMuc2VhcmNoVmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLmJsdXIuZW1pdChldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25JbnB1dEZvY3VzKGV2ZW50OiBFdmVudCkge1xyXG4gICAgICAgIHRoaXMuZm9jdXNFdmVudC5lbWl0KGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaW5wdXRDbGFzcygpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBjbGFzc2VzOiBzdHJpbmcgPSAnJztcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRDbGFzc2VzKSB7XHJcbiAgICAgICAgICAgIGNsYXNzZXMgPSB0aGlzLmlucHV0Q2xhc3Nlcy5qb2luKCcgJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2xhc3NlcztcclxuICAgIH1cclxuXHJcbiAgICBmb2N1cygpIHtcclxuICAgICAgICAoPEhUTUxJbnB1dEVsZW1lbnQ+dGhpcy5pbnB1dEZpZWxkLm5hdGl2ZUVsZW1lbnQpLmZvY3VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICB0aGlzLm9uVHlwZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlU2VydmljZS5pc09wZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNlYXJjaFN0YXRlID0gdGhpcy5zZWFyY2hTdGF0ZXMuVW50cmFja2VkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdmFsaWRhdGVTZXJ2aWNlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5zZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkF1dG9jb21wbGV0ZVNlcnZpY2UgbXVzdCBiZSBpbXBsZW1lbnRlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlzUGFyYW1ldGVyaXplZFNlYXJjaCh0aGlzLnNlcnZpY2UpICYmICh0aGlzLnNlYXJjaFBhcmFtZXRlcnMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLnNlYXJjaFBhcmFtZXRlcnMgPT09IG51bGwpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBsZWFzZSBwcm92aWRlIGFkZGl0aW9uYWxTZWFyY2hQYXJhbXMgb3IganVzdCBwcm92aWRlIEF1dG9jb21wbGV0ZVNvdXJjZVNlcnZpY2UgaW5zdGFlYWQgb2YgUGFyYW1ldGVyaXplZEF1dG9jb21wbGV0ZVNvdXJjZVNlcnZpY2VcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25BY3RpdmVJbmRleENoYW5nZWQoYWN0aXZlSW5kZXg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGxldCBoaWdobGlnaHRlZEl0ZW06IEF1dG9jb21wbGV0ZUl0ZW07XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVJbmRleCA9PT0gREVGQVVMVF9BQ1RJVkVfSU5ERVgpIHtcclxuICAgICAgICAgICAgaGlnaGxpZ2h0ZWRJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hWYWx1ZSA9IHRoaXMub3JpZ2luYWxTZWFyY2hWYWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBoaWdobGlnaHRlZEl0ZW0gPSB0aGlzLnNlYXJjaFJlc3VsdFthY3RpdmVJbmRleF07XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoVmFsdWUgPSBoaWdobGlnaHRlZEl0ZW0udmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSh0aGlzLnNlYXJjaFZhbHVlKTtcclxuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkLmVtaXQoaGlnaGxpZ2h0ZWRJdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc2V0U2VhcmNoVGltZW91dCgpIHtcclxuICAgICAgICB0aGlzLmNsZWFyU2VhcmNoVGltZW91dCgpO1xyXG4gICAgICAgIHRoaXMuc2V0U2VhcmNoVGltZW91dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0U2VhcmNoVGltZW91dCgpIHtcclxuICAgICAgICB0aGlzLnR5cGluZ1RpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuc2VhcmNoLmJpbmQodGhpcyksIHRoaXMucGF1c2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJTZWFyY2hUaW1lb3V0KCkge1xyXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnR5cGluZ1RpbWVvdXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VhcmNoKCkge1xyXG4gICAgICAgIHRoaXMuaXRlbUxpc3RTZXJ2aWNlLnJlc3RvcmVJbnRpYWxBY3RpdmVJbmRleCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy52YWxpZHNlYXJjaFRlcm0oKSkge1xyXG4gICAgICAgICAgICB0aGlzLnBlcmZvcm1TZWFyY2goKS5maXJzdCgpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgIChyZXN1bHRzOiBBdXRvY29tcGxldGVJdGVtW10pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hTdGF0ZSAhPT0gdGhpcy5zZWFyY2hTdGF0ZXMuVW50cmFja2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlU2VydmljZS5pc09wZW4gPSByZXN1bHRzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbUxpc3RTZXJ2aWNlLml0ZW1zID0gcmVzdWx0cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hSZXN1bHQgPSByZXN1bHRzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFN0YXRlID0gdGhpcy5zZWFyY2hTdGF0ZXMuRmluaXNoZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHBlcmZvcm1TZWFyY2goKTogT2JzZXJ2YWJsZTxBdXRvY29tcGxldGVJdGVtW10+IHtcclxuICAgICAgICBpZiAodGhpcy5pc1BhcmFtZXRlcml6ZWRTZWFyY2godGhpcy5zZXJ2aWNlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gKDxQYXJhbWV0ZXJpemVkQXV0b2NvbXBsZXRlU291cmNlU2VydmljZT50aGlzLnNlcnZpY2UpLmdldFdpdGhQYXJhbXModGhpcy5zZWFyY2hWYWx1ZSwgdGhpcy5zZWFyY2hQYXJhbWV0ZXJzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gKDxBdXRvY29tcGxldGVTb3VyY2VTZXJ2aWNlPnRoaXMuc2VydmljZSkuZ2V0KHRoaXMuc2VhcmNoVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHZhbGlkc2VhcmNoVGVybSgpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuc2VhcmNoVmFsdWUgfHwgJycpLmxlbmd0aCA+PSB0aGlzLm1pbkNoYXJzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNQYXJhbWV0ZXJpemVkU2VhcmNoKHNlcnZpY2U6IEF1dG9jb21wbGV0ZVNvdXJjZVNlcnZpY2UgfCBQYXJhbWV0ZXJpemVkQXV0b2NvbXBsZXRlU291cmNlU2VydmljZSk6IHNlcnZpY2UgaXMgUGFyYW1ldGVyaXplZEF1dG9jb21wbGV0ZVNvdXJjZVNlcnZpY2Uge1xyXG4gICAgICAgIHJldHVybiAoPFBhcmFtZXRlcml6ZWRBdXRvY29tcGxldGVTb3VyY2VTZXJ2aWNlPnNlcnZpY2UpLmdldFdpdGhQYXJhbXMgIT09IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldERlZmF1bHRJZk51bGxPclVuZGVmaW5lZDxUPih2YWx1ZTogVCwgZGVmYXVsdFZhbHVlOiBUKTogVCB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGxcclxuICAgICAgICAgICAgPyBkZWZhdWx0VmFsdWVcclxuICAgICAgICAgICAgOiB2YWx1ZTtcclxuICAgIH1cclxufSJdfQ==